syntax = "proto3";

option java_package = "com.pjtsearch.opencontroller_lib_proto";
option java_multiple_files = true;

package model;

message House {
  string name = 1;
  repeated Room room = 2;
  repeated Device device = 3;
}

message Room {
  string name = 1;
  repeated Controller controller = 2;
}

message Controller {
  string name = 1;
  repeated Widget widget = 2;
}

message Device {
  string id = 1;
  repeated Action action = 2;
  repeated DynamicValue dynamic_value = 3;
}

message Widget {
  oneof inner {
    Button button = 1;
    DynamicText dynamic_text = 2;
    Row row = 3;
    Column column = 4;
    ArrowLayout arrow_layout = 5;
    Space space = 6;
  }
}

message Button {
  ActionRef action = 1;
  string text = 3;
  oneof optional_icon {
    Icon icon = 2;
  }
}

message DynamicText {
  DynamicValueRef value = 1;
}

message Row {
  repeated Widget child = 1;
}

message Column {
  repeated Widget child = 1;
}

message ArrowLayout {
  Widget top = 1;
  Widget bottom = 2;
  Widget left = 3;
  Widget right = 4;
  Widget center = 5;
}

message Space {}

message ActionRef {
  string device = 1;
  string action = 2;
}

message Action {
  string id = 1;
  oneof inner {
    HttpAction http_action = 2;
    TCPAction tcp_action = 3;
    MacroAction macro_action = 4;
    DelayAction delay_action = 5;
  }
}

message HttpAction {
  string url = 1;
  HttpMethod method = 2;
}

enum HttpMethod {
    GET = 0;
    HEAD = 1;
    POST = 2;
    PUT = 3;
    PATCH = 4;
    DELETE = 5;
}

message TCPAction {
  string address = 1;
  string command = 2;
}

message MacroAction {
  repeated ActionRef action = 1;
}

message DelayAction {
  int32 time = 1;
}


message DynamicValueRef {
  string device = 1;
  string dynamic_value = 2;
}

message DynamicValue {
  string id = 1;
  string script = 2;
  repeated DynamicResource dynamic_resource = 3;
}

message DynamicResource {
  oneof inner {
    DateResource date_resource = 1;
  }
}

message DateResource {}

enum Icon {
  STAR = 0;
}